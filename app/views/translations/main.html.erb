<%= render "shared/navbar" %>

<% if @word_data.present? %>
<h1><%= @word_data[:title]%> (<%= @source_language_name %>)</h1>
<% else %>
<h1>No word searched yet..</h1>
<% end %>

<% if current_user && @word_data.present? %>
  <div>
    <% if current_user.liked_words.exists?(word: @word_data[:title], source_lang: params[:source_lang]) %>
      <p>Already saved this word</p>
    <% else %>
      <%= form_with url: save_word_path, method: :post, local: true do |form| %>
        <%= hidden_field_tag :word, @word_data[:title] %>
        <%= hidden_field_tag :source_lang, params[:source_lang] %>
        <%= submit_tag "Save Word", 
              class: "save-word-button" %>
      <% end %>
    <% end %>
  </div>
<% end %>


<%= form_with url: translations_path, method: :post, local: true do |form| %>
  <div>
    <%= form.label :text, "Translate word" %><br>
    <%= form.text_area :text, rows: 3, placeholder: "Write here...", value: session[:last_searched_word].presence || "" %>
  </div>

  <div>
  <%= form.label :source_lang, "Language" %><br>
  <%= form.select :source_lang, 
        TranslationsController::LANGUAGE_NAMES.map { |key, value| [value, key] }, 
        { prompt: session[:last_searched_lang].present? ? nil : "Choose language" }, 
        { selected: session[:last_searched_lang] || params[:source_lang] } %>
</div>


  <div>
    <%= form.submit "Translate" %>
  </div>
<% end %>
<% flash.each do |key, message| %>
      <%= message %>
<% end %>

<% if @word_data.present? %>
  <h2>Etymology:</h2>
  <p><%= @word_data[:etymology].presence || "No etymology found." %></p>

  <h2>Meaning:</h2>
  <p><%= @word_data[:verb_section].presence || "No meaning found." %></p>
  
  <h2>Synonyms:</h2>
  <p><%= @translated_synonyms&.join(", ").presence || "No synonyms found." %></p>  

<% end %>

<div style="display: flex; gap: 40px; align-items: flex-start;">
  <% if @translations.present? && @translations.any? %>
    <div>
      <h2>Translations:</h2>
      <ol style="list-style: none; padding: 0;">
        <% @translations.each do |lang, translation| %>
          <% color = similarity_color(translation[:similarity] || 0, lang, params[:source_lang]) %>
          <li style="display: flex; align-items: center; gap: 10px; color: <%= color %>; white-space: nowrap;">
            
            <%= button_to translations_path, 
                  method: :post, 
                  params: { text: translation[:transliterated], source_lang: lang },
                  class: "translation-link",
                  style: "color: inherit; background: none; border: none; padding: 0; font: inherit; cursor: pointer; text-decoration: none;" do %>
              <strong><%= TranslationsController::LANGUAGE_NAMES[lang] %>: </strong> 
              <%= translation[:transliterated] %>
            <% end %>

            <% if TranslationsController::TRANSLITERATION_LANGUAGES.include?(lang) %>
              <span>(<%= translation[:original] %>)</span>
            <% end %>

            <strong>&empty;</strong><%= translation[:similarity] %>%
          </li>
        <% end %>  
      </ol>
    </div>
  <% end %>

  <div>
    <%= render "map", colors: @colors %>
  </div>
</div>

</div>





